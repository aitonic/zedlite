# Context
Filename: TASKS/first_step.md
Created On: 2025-08-13
Created By: GPT-5 AI
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
按 @first_step 的步骤进行修改，第一步将本仓库（zedlite，基于 Zed 工作区）精简为写作编辑器：禁用/移除编码相关能力（LSP、调试/DAP、Git、终端/任务等），保留核心编辑器、面板与 Markdown 基础渲染，并为后续拼写检查预留接口。

# Project Overview
- 仓库为 Cargo workspace，`default-members = ["crates/zed"]`，构建入口集中在 `crates/zed`。
- 工作区内存在大量编码相关 crates（例如 `lsp`、`dap`、`debugger_*`、`git`/`git_ui`、`terminal`/`terminal_view`、`project_symbols`、`prettier`、`languages`、`language_*` 等），以及与写作相关的 `markdown`、`markdown_preview`、`rich_text`、`ui`、`panel` 等。
- 目标第一步仅做“减法”：通过编译期开关与启动流程改造，避免初始化/引用编码相关模块，同时隐藏相关菜单与快捷键，保证 `cargo build` 默认即可得到写作版。

---

# Analysis (Populated by RESEARCH mode)
- 工作区成员众多；默认构建目标是 `crates/zed`，故优先在 `crates/zed` 实施集中控制（特性开关 + 启动路径裁剪），避免大范围删除 workspace 成员，降低回归与冲突风险。
- 需要在入口层面屏蔽：
  - LSP/语言相关：`lsp`、`languages`、`language_*`、`language_selector`、`language_tools`、`project_symbols`、`prettier` 等。
  - 调试相关：`dap`、`dap_adapters`、`debugger_tools`、`debugger_ui`。
  - Git 相关：`git`、`git_ui`、`git_hosting_providers`、`worktree`、`jj`/`jj_ui`。
  - 终端/运行相关：`terminal`、`terminal_view`、`repl`、`task`/`tasks_ui`。
  - 远程/扩展：`remote`、`remote_server`、（扩展/插件体系暂保留但默认不暴露编码能力）。
- UI 层面需要隐藏的入口：相关菜单项、命令注册、状态栏提示、面板入口；同时需要调整 `assets/keymaps` 下默认快捷键，去除运行/调试/Git/终端类映射。
- 写作相关能力保留：核心编辑器/缓冲区、面板管理、`markdown`/`markdown_preview`、`rich_text`、`ui`/`panel`、`outline_panel`（如强依赖语言服务则一并隐藏）。

# Proposed Solution (Populated by INNOVATE mode)
- 方案A（推荐）：在 `crates/zed` 增加编译特性 `writer` 并设为默认特性。以 `#[cfg(feature = "writer")]` 或 `#[cfg(not(feature = "writer"))]` 包裹初始化路径与菜单/命令注册，构建“写作版”最小集；不改动 workspace 成员列表，避免破坏内部 crate 的 `workspace = true` 依赖模式。
- 方案B：直接从 workspace 移除相关成员并批量修改 `Cargo.toml`/代码引用。风险大、回退困难、影响范围广，不作为第一步。
- 选择：方案A。

# Implementation Plan (Generated by PLAN mode)
- 在 `crates/zed` 引入特性 `writer`，并将其加入 `default = ["writer"]`，以便 `cargo build` 默认编译写作版。
- 在 `crates/zed/src/main.rs`（以及其应用/启动装配文件，如 `app.rs`/`lib.rs`）中：当启用 `writer` 时跳过初始化 LSP、DAP、Git、终端、远程及其 UI 面板/命令；仅保留编辑器、面板基础、Markdown 相关与 Assistant 面板。
- 在菜单/命令注册位置（`crates/zed` 内或 `crates/menu` 的集成点）：在 `writer` 下不注册运行/调试/Git/终端等命令与菜单；必要时为写作保留“字数统计/Markdown 预览”等入口。
- 在 `assets/keymaps`：删除/屏蔽运行/调试/Git/终端相关快捷键映射，避免指向不可用命令。
- 构建验证：`cargo build`；若有上游 crate 通过 `workspace.dependencies` 被强制拉入，继续在 `crates/zed` 侧以 feature gate 避免引用路径。

```
Implementation Checklist:
1. 新建任务文件 TASKS/first_step.md，记录分析/方案/计划（当前步骤）。
2. 编辑 crates/zed/Cargo.toml：新增特性 `writer` 并设为默认；为涉及的依赖添加 `optional = true` 与特性开关映射（仅在非 writer 时启用）。
3. 编辑 crates/zed/src/main.rs（及其应用装配文件）：在 `writer` 下跳过初始化 LSP/DAP/Git/终端/远程及相关 UI 面板与命令注册。
4. 编辑菜单/命令注册文件（位于 crates/zed 或 crates/menu 的集成点）：`writer` 下隐藏运行/调试/Git/终端类菜单项和命令。
5. 编辑 assets/keymaps（默认 keymap 文件）：移除运行/调试/Git/终端相关快捷键。
6. 构建验证：`cargo build`；根据编译错误继续收敛引用点，直至默认构建通过。
```

# Current Execution Step (Updated by EXECUTE mode when starting a step)
> Currently executing: "6. 构建验证：cargo build（writer 默认特性）"

# Task Progress (Appended by EXECUTE mode after each step completion)
*   2025-08-13  
    *   Step: 2-3. crates/zed 添加默认特性 `writer` 并以编译期开关裁剪启动初始化路径  
    *   Modifications:  
        - 编辑 `crates/zed/Cargo.toml`：新增 `[features]`，`default = ["writer"]`。  
        - 编辑 `crates/zed/src/main.rs`：以 `#[cfg(not(feature = "writer"))]` 包裹 LSP、DAP、Git、Terminal、REPL、Project Symbols、Tasks UI、Language Tools/Selector/Toolchain/Terminal 初始化。  
        - 编辑 `crates/zed/src/zed.rs`：将面板与状态栏、工具栏中与 LSP/DAP/Git/Terminal 相关的导入与组件放入特性条件分支；新增 `initialize_panels_writer` 以提供无终端/Git/调试的面板集；修正语句级属性导致的语法问题（改为块级条件）。  
    *   Change Summary: 默认启用 writer 模式，避免编码相关模块初始化与 UI 暴露，保留核心编辑体验与 Markdown/富文本相关能力入口。  
    *   Reason: 执行计划第 2-3 步以实现最小入侵的写作版构建路径。  
    *   Blockers: 需运行 `cargo build` 确认是否仍有未收敛的符号引用/条件编译错误。  
    *   User Confirmation Status: Pending

# Final Review (Populated by REVIEW mode)
